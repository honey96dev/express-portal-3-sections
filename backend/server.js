!function(e){var r={};function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,r,t){s.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,r){if(1&r&&(e=s(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)s.d(t,n,function(r){return e[r]}.bind(null,n));return t},s.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(r,"a",r),r},s.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},s.p="/",s(s.s=20)}([function(e,r){e.exports=require("express")},function(e,r){e.exports=require("sprintf-js")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("cluster")},function(e,r){e.exports=require("express-jwt")},function(e,r){e.exports=require("dotenv")},function(e,r){e.exports=require("http-errors")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("morgan")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("compression")},function(e,r){e.exports=require("express-fileupload")},function(e,r){e.exports=require("uuid")},function(e,r){e.exports=require("mkdirp")},function(e,r){e.exports=require("mysql2")},function(e,r){e.exports=require("tracer")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("debug")},function(e,r){e.exports=require("http")},function(e,r,s){"use strict";s.r(r);var t={};s.r(t),s.d(t,"server",function(){return L}),s.d(t,"mysql",function(){return _});var n={};s.r(n),s.d(n,"server",function(){return w}),s.d(n,"mysql",function(){return I});var i=s(5),o=s.n(i),a=s(6),u=s.n(a),c=s(0),l=s.n(c),d=s(2),f=s.n(d),g=s(7),p=s.n(g),m=s(8),y=s.n(m),S=s(4),E=s.n(S),v=s(9),b=s.n(v),O=s(10),U=s.n(O),A=s(11),R=s.n(A);const L={port:8080,baseUrl:"http://127.0.0.1:8080/"},_={connectionLimit:10,host:"127.0.0.1",user:"root",password:"",database:"portal3sections",port:3306},w={port:80,baseUrl:"http://108.160.135.63/"},I={connectionLimit:10,host:"127.0.0.1",user:"root",password:"",database:"portal3sections",port:3306};let q=t;const h={isDev:!1,port:(q=n).server.port,baseUrl:q.server.baseUrl,name:"Portal - 3 sections",description:"Portal - 3 sections",author:"Zhenlong J.",secret:"portal3sections@@",environment:"production"},x=q.mysql,j={name:"portal3sections",key:"portal3sections",secret:"portal3sections@@",secretAdmin:"portal3sections_admin@@"},N={users:"users",admins:"admins",mediaSlider:"media_slider",ourServices:"our_services",businessPartner:"business_partner",humanOurServices:"human_our_services"};var k={server:h,mysql:x,session:j,dbTblName:N},P=s(1),T=s(12),V=s.n(T),M=s(13),D=s.n(M),C=s(14),J=s.n(C).a.createPool(k.mysql),F={en:{success:"success",error:"error",unknownServerError:"Unknown server error",emailAlreadyRegistered:"This email is already registered.",usernameAlreadyRegistered:"This username is already registered.",successfullyRegistered:"Successfully registered. Please try to sign in.",emailIsIncorrect:"Email is invalid",usernameIsIncorrect:"Username is incorrect",passwordIsIncorrect:"Password is incorrect",successfullySignedIn:"Successfully signed in",successfullySignedOut:"Successfully signed out",error404:"Not Fount",error500:"Unknown server error",successfullySaved:"Successfully saved",successfullyAdded:"Successfully added",successfullyEdited:"Successfully edited",successfullyChanged:"Successfully changed",successfullyDeleted:"Successfully Deleted",currentPasswordIncorrect:"Current password is incorrect",failedDueToUnknownServerError:"Failed due to unknown server error",invalidParameters:"Invalid Parameters",notUploaded:"Not uploaded",successfullyUploaded:"Successfully uploaded"},ar:{success:"success",error:"error",unknownServerError:"خطأ غير معروف في الخادم",emailAlreadyRegistered:"عنوان البريد الإلكترونى هذا مسجل بالفعل",usernameAlreadyRegistered:"وسجلت بالفعل اسم المستخدم هذا",successfullyRegistered:"سجلت بنجاح. يرجى محاولة تسجيل الدخول",emailIsIncorrect:"البريد الإلكتروني غير صالح",usernameIsIncorrect:"اسم المستخدم غير صحيح",passwordIsIncorrect:"كلمة المرور غير صحيحة",successfullySignedIn:"تم تسجيل الدخول بنجاح",successfullySignedOut:"تم تسجيل الخروج بنجاح",error404:"لم يتم العثور على",error500:"خطأ غير معروف في الخادم",successfullySaved:"حفظ بنجاح",successfullyAdded:"أضيف بنجاح",successfullyEdited:"تم التعديل بنجاح",successfullyChanged:"تغيرت بنجاح",successfullyDeleted:"تم الحذف بنجاح",currentPasswordIncorrect:"كلمة المرور الحالية غير صحيحة",failedDueToUnknownServerError:"فشل بسبب خطأ غير معروف في الخادم",invalidParameters:"معلمات غير صالحة",notUploaded:"لم يتم الرفع",successfullyUploaded:"تم الرفع بنجاح"}},W=s(15),H=s.n(W).a.colorConsole();const z=l.a.Router();z.post("/upload/:dir",(e,r,s)=>{const t=e.params,{dir:n}=t,i=e.get("language"),o=F[i],{files:a}=e;if(0==Object.keys(a).length)return H.error(JSON.stringify(error)),H.error(__filename),r.status(200).send({result:o.error,message:o.notUploaded});const u=a.file,c=f.a.extname(u.name),l=process.cwd(),d=Object(P.sprintf)("%s%s",V()(),c),g=Object(P.sprintf)("%s/public/uploads/%s",l,n),p=Object(P.sprintf)("%s/%s",g,d);D()(g,()=>{u.mv(p,function(e){return e?(H.error(JSON.stringify(e)),H.error(__filename),r.status(200).send({result:o.error,message:o.notUploaded})):r.status(200).send({result:o.success,message:o.successfullyUploaded,filename:d,oldFilename:u.name})})})});var Y=z,$=s(16),B=s.n($),K=s(17),Z=s.n(K),G=e=>{return Z.a.createHmac("sha256",k.server.secret).update(e).digest("hex")};const Q=l.a.Router();Q.post("/sign-in",(e,r,s)=>{const t=e.body,n=e.get("language"),{username:i,password:o}=t;let a=Object(P.sprintf)("SELECT `email` FROM `%s` WHERE BINARY `username` = '%s';",N.admins,i);J.query(a,null,(e,s,t)=>{if(e)return console.error("admin-signin",__filename,JSON.stringify(e)),void r.status(200).send({result:F[n].error,message:F[n].unknownServerError});if(0===s.length)return void r.status(200).send({result:F[n].error,message:F[n].usernameIsIncorrect});const u=G(o);a=Object(P.sprintf)("SELECT U.* FROM `%s` U WHERE BINARY U.username = '%s' AND BINARY U.hash = '%s';",N.admins,i,u),J.query(a,null,(e,s,t)=>{if(e)return console.error("admin-signin",__filename,JSON.stringify(e)),void r.status(200).send({result:F[n].error,message:F[n].unknownServerError});if(0===s.length)return void r.status(200).send({result:F[n].error,message:F[n].passwordIsIncorrect});let i=s[0];i.token=B.a.sign({sub:i.id},j.secretAdmin),r.status(200).send({result:F[n].success,message:F[n].successfullySignedIn,data:i})})})});var X=Q;var ee={mediaSlider:"/uploads/media-slider",ourServices:"/uploads/our-services",businessPartner:"/uploads/business-partner"};const re=l.a.Router(),se=(e,r,s)=>{const t=e.get("language"),n=e.body,{category:i}=n,o=F[t];let a=Object(P.sprintf)("SELECT * FROM `%s` WHERE `category` = '%s';",N.mediaSlider,i);J.query(a,null,(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});r.status(200).send({result:o.success,data:s})})},te=(e,r,s,t)=>{const n=e.get("language"),i=e.body,{id:o,category:a,name:u,title:c,description:l,media:d,note:f,originMedia:g,mediaSize:p}=i,m=F[n],y=d.startsWith("/")?d:`${ee.mediaSlider}/${d}`,S=[[o,a,u,c,l,y,g,p,f]];let E=Object(P.sprintf)("INSERT INTO `%s` VALUES ? ON DUPLICATE KEY UPDATE `name` = VALUES(`name`), `title` = VALUES(`title`), `description` = VALUES(`description`), `media` = VALUES(`media`), `originMedia` = VALUES(`originMedia`), `mediaSize` = VALUES(`mediaSize`), `note` = VALUES(`note`);",N.mediaSlider);J.query(E,[S],(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:m.error,message:m.unknownServerError});H.log(s),r.status(200).send({result:m.success,message:o?m.successfullyEdited:m.successfullyAdded,data:{insertId:o||s.insertId}})})};re.post("/list",(e,r,s)=>{se(e,r)}),re.post("/edit",(e,r,s)=>{te(e,r)}),re.post("/delete",(e,r,s)=>{const t=e.get("language"),n=e.body,{id:i}=n,o=F[t];let a=Object(P.sprintf)("DELETE FROM `%s` WHERE `id` = '%d';",N.mediaSlider,i);J.query(a,null,(s,t,n)=>{if(s)return H.error(JSON.stringify(s)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});se(e,r)})});var ne=re;const ie=l.a.Router(),oe=(e,r,s)=>{const t=e.get("language"),n=e.body,{category:i}=n,o=F[t];let a=Object(P.sprintf)("SELECT * FROM `%s` WHERE `category` = '%s';",N.ourServices,i);console.log(a),J.query(a,null,(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});r.status(200).send({result:o.success,data:s})})},ae=(e,r,s,t)=>{const n=e.get("language"),i=e.body,{id:o,category:a,name:u,title:c,description:l,media:d,note:f,originMedia:g,mediaSize:p}=i,m=F[n],y=d.startsWith("/")?d:`${ee.ourServices}/${d}`,S=[[o,a,u,c,l,y,g,p,f]];let E=Object(P.sprintf)("INSERT INTO `%s` VALUES ? ON DUPLICATE KEY UPDATE `name` = VALUES(`name`), `title` = VALUES(`title`), `description` = VALUES(`description`), `media` = VALUES(`media`), `originMedia` = VALUES(`originMedia`), `mediaSize` = VALUES(`mediaSize`), `note` = VALUES(`note`);",N.ourServices);J.query(E,[S],(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:m.error,message:m.unknownServerError});H.log(s),r.status(200).send({result:m.success,message:o?m.successfullyEdited:m.successfullyAdded,data:{insertId:o||s.insertId}})})};ie.post("/list",(e,r,s)=>{oe(e,r)}),ie.post("/edit",(e,r,s)=>{ae(e,r)}),ie.post("/delete",(e,r,s)=>{const t=e.get("language"),n=e.body,{id:i}=n,o=F[t];let a=Object(P.sprintf)("DELETE FROM `%s` WHERE `id` = '%d';",N.ourServices,i);J.query(a,null,(s,t,n)=>{if(s)return H.error(JSON.stringify(s)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});oe(e,r)})});var ue=ie;const ce=l.a.Router(),le=(e,r,s)=>{const t=e.get("language"),n=e.body,{category:i}=n,o=F[t];let a=Object(P.sprintf)("SELECT * FROM `%s` WHERE `category` = '%s';",N.businessPartner,i);console.log(a),J.query(a,null,(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});r.status(200).send({result:o.success,data:s})})},de=(e,r,s,t)=>{const n=e.get("language"),i=e.body,{id:o,category:a,name:u,title:c,description:l,media:d,note:f,originMedia:g,mediaSize:p,social1:m,social2:y,social3:S}=i,E=F[n],v=d.startsWith("/")?d:`${ee.businessPartner}/${d}`,b=[[o,a,u,c,l,v,g,p,m,y,S,f]];let O=Object(P.sprintf)("INSERT INTO `%s` VALUES ? ON DUPLICATE KEY UPDATE `name` = VALUES(`name`), `title` = VALUES(`title`), `description` = VALUES(`description`), `media` = VALUES(`media`), `originMedia` = VALUES(`originMedia`), `mediaSize` = VALUES(`mediaSize`), `social1` = VALUES(`social1`), `social2` = VALUES(`social2`), `social3` = VALUES(`social3`), `note` = VALUES(`note`);",N.businessPartner);J.query(O,[b],(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:E.error,message:E.unknownServerError});H.log(s),r.status(200).send({result:E.success,message:o?E.successfullyEdited:E.successfullyAdded,data:{insertId:o||s.insertId}})})};ce.post("/list",(e,r,s)=>{le(e,r)}),ce.post("/edit",(e,r,s)=>{de(e,r)}),ce.post("/delete",(e,r,s)=>{const t=e.get("language"),n=e.body,{id:i}=n,o=F[t];let a=Object(P.sprintf)("DELETE FROM `%s` WHERE `id` = '%d';",N.businessPartner,i);J.query(a,null,(s,t,n)=>{if(s)return H.error(JSON.stringify(s)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});le(e,r)})});var fe=ce;const ge=l.a.Router();ge.use("/common",Y),ge.use("/auth",X),ge.use("/media-slider",ne),ge.use("/our-services",ue),ge.use("/business-partner",fe);var pe=ge;const me=l.a.Router();me.use("/admin",pe);var ye=me;const Se=l.a.Router();Se.post("/list",(e,r,s)=>{((e,r,s)=>{const t=e.get("language"),n=e.body,{category:i}=n,o=F[t];let a=Object(P.sprintf)("SELECT * FROM `%s` WHERE `category` = '%s';",N.mediaSlider,i);J.query(a,null,(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});r.status(200).send({result:o.success,data:s})})})(e,r)});var Ee=Se;const ve=l.a.Router();ve.post("/list",(e,r,s)=>{((e,r,s)=>{const t=e.get("language"),n=e.body,{category:i}=n,o=F[t];let a=Object(P.sprintf)("SELECT * FROM `%s` WHERE `category` = '%s';",N.ourServices,i);J.query(a,null,(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});r.status(200).send({result:o.success,data:s})})})(e,r)});var be=ve;const Oe=l.a.Router();Oe.post("/list",(e,r,s)=>{((e,r,s)=>{const t=e.get("language"),n=e.body,{category:i}=n,o=F[t];let a=Object(P.sprintf)("SELECT * FROM `%s` WHERE `category` = '%s';",N.businessPartner,i);J.query(a,null,(e,s,t)=>{if(e)return H.error(JSON.stringify(e)),H.error(__filename),void r.status(200).send({result:o.error,message:o.unknownServerError});r.status(200).send({result:o.success,data:s})})})(e,r)});var Ue=Oe;const Ae=l.a.Router();Ae.use("/media-slider",Ee),Ae.use("/our-services",be),Ae.use("/business-partner",Ue);var Re=Ae;const Le=l()(),_e=process.cwd();Le.set("views",f.a.join(_e,"views")),Le.set("view engine","pug"),Le.use(y()("dev")),Le.use(l.a.json()),Le.use(l.a.urlencoded({extended:!1})),Le.use(p()()),Le.use(b()()),Le.use(U()()),Le.use(R()({limits:{fileSize:52428800}})),Le.use("/api",E()({secret:j.secret}).unless({path:["/api/auth/sign-in","/api/auth/sign-up",/\/api\/admin\/*/]})),Le.use("/api/admin",E()({secret:j.secretAdmin}).unless({path:["/api/admin/auth/sign-in"]})),Le.use("/api",ye),Le.use("/assets-api",Re),Le.use("/admin",l.a.static(f.a.join(_e,"admin-frontend"))),Le.get("/admin/*",function(e,r){r.sendFile(f.a.join(_e,"admin-frontend/index.html"))}),Le.use("/assets",l.a.static(f.a.join(_e,"public"))),Le.use(l.a.static(f.a.join(_e,"frontend"))),Le.get("*",function(e,r){r.sendFile(f.a.join(_e,"frontend/index.html"))}),Le.use(function(e,r,s){s(u()(404))}),Le.use(function(e,r,s,t){s.locals.message=e.message,s.locals.error="development"===r.app.get("env")?e:{},s.status(e.status||500),s.render("error")});var we=Le,Ie=s(18),qe=s.n(Ie),he=s(19),xe=s.n(he),je=s(3),Ne=s.n(je);let ke,Pe,Te;o.a.config(),Ne.a.isMaster&&(Ne.a.fork(),Ne.a.on("exit",function(e,r,s){Ne.a.fork()})),Ne.a.isWorker&&(ke=new qe.a("express:server"),Pe=function(e){const r=parseInt(e,10);if(isNaN(r))return e;if(r>=0)return r;return!1}(h.port),we.set("port",Pe),(Te=xe.a.createServer(we)).listen(Pe),Te.on("error",function(e){if("listen"!==e.syscall)throw e;const r="string"==typeof Pe?"Pipe "+Pe:"Port "+Pe;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use"),process.exit(1);break;default:throw e}}),Te.on("listening",function(){const e=Te.address(),r="string"==typeof e?"pipe "+e:"port "+e.port;ke("Listening on "+r),console.log("Listening on "+r)}))}]);